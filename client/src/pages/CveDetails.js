import Scores from "../components/Scores";
import Metrics from "../components/Metrics";
import CpeTable from "../components/CpeTable";
import Description from "../components/Description";
import Metricetable from "../components/Metricetable";
import { useParams } from "react-router-dom";
import React, { useEffect, useState } from "react";

const CveDetails = () => {
  const { cveId } = useParams();
  const [cve, setCve] = useState(null);

  const fetchCve = async () => {
    try {
      const response = await fetch(`https://cve-information-project-1.onrender.com/api/cves/${cveId}`);
      const data = await response.json();
      setCve(data.cve);
    } catch (error) {
      console.error("Error fetching CVE data by ID:", error.message);
    }
  };

  useEffect(() => {
    fetchCve();
  }, []);

  return (
    <div className="bg-gradient-to-r from-gray-100 via-gray-200 to-gray-100 min-h-screen py-10">
      {cve && (
        <div className="w-full max-w-4xl mx-auto">
          {/* Title */}
          <h2 className="text-4xl font-extrabold text-indigo-900 mb-6 text-center" style={{ fontFamily: "'Poppins', sans-serif" }}>
          Detailed Vulnerability Information: {cve.id}
          </h2>

          {/* Description Section */}
          <div className="bg-gray-50 shadow-md rounded-lg p-6 mb-8">
            <h3 className="text-2xl font-semibold mb-4 text-indigo-800">Description</h3>
            <Description description={cve.description} />
          </div>

          {/* Metrics Section */}
          <div className="bg-gray-50 shadow-md rounded-lg p-6 mb-8">
            <h3 className="text-2xl font-semibold mb-4 text-indigo-800">Metrics</h3>
            <Metrics metrics={cve.metrics} />
          </div>

          {/* Metric Table Section */}
          <div className="bg-gray-50 shadow-md rounded-lg p-6 mb-8">
            <h3 className="text-2xl font-semibold mb-4 text-indigo-800">CVSS v2 Metrics</h3>
            <Metricetable
              data={cve.metrics.cvssV2.cvssData}
              headings={[
                "Access Vector",
                "Access Complexity",
                "Authentication",
                "Confidentiality Impact",
                "Integrity Impact",
                "Availability Impact",
              ]}
            />
          </div>

          {/* Scores Section */}
          <div className="bg-gray-50 shadow-md rounded-lg p-6 mb-8">
            <h3 className="text-2xl font-semibold mb-4 text-indigo-800">Scores</h3>
            <Scores scores={cve.metrics.cvssV2} />
          </div>

          {/* CPE Table Section */}
          <div className="bg-gray-50 shadow-md rounded-lg p-6 mb-8">
            <h3 className="text-2xl font-semibold mb-4 text-indigo-800">CPE Matches</h3>
            <CpeTable
              cpeMatch={cve.configurations[0].nodes[0].cpeMatch}
              headings={["Criteria", "Match Criteria Id", "Vulnerable"]}
            />
          </div>
        </div>
      )}
    </div>
  );
};

export default CveDetails;
