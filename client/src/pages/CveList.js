import React, { useState, useEffect } from "react";
import {useNavigate } from "react-router-dom";
const CveList = () => {
  const [cves, setCves] = useState([]);
  const [totalRecords, setTotalRecords] = useState(0);
  const [resultsPerPage, setResultsPerPage] = useState(10);
  const navigate = useNavigate();

  const fetchCves = async () => {
    try {
      const response = await fetch(
        `http://localhost:5001/api/cves?page=1&limit=${resultsPerPage}`
      );
      const data = await response.json();
      setCves(data.results);
      setTotalRecords(data.cves.length);
    } catch (error) {
      console.error("Error fetching CVEs:", error.message);
    }
  };
  const fetchlength = async () => {
    try {
      const response = await fetch(`http://localhost:5000/totalcves`);
      const data = await response.json();
      setTotalRecords(data.cves);
    } catch (error) {
      console.error("Error fetching CVEs:", error.message);
    }
  }
  useEffect(() => {
    fetchlength();
  },[]);

  useEffect(() => {
    fetchCves();
  }, [resultsPerPage]);

  const handleResultsPerPageChange = (event) => {
    setResultsPerPage(parseInt(event.target.value));
  };

  return (
    <div className="flex flex-col items-center">
      <h1 className="text-2xl font-bold pt-20">CVE LIST</h1>
      <p className="mt-20 text-start mb-2 w-4/5 pl-28 mr-2">
        Total Records: {totalRecords}
      </p>
      <div className="flex justify-center items-center">
        <table>
          <thead className="text-md bg-gray-200">
            <tr className="uppercase">
              <th className="px-16 py-3 border-2 border-gray-200">CVE ID</th>
              <th className="px-16 py-3 border-2 border-gray-200">Identifier</th>
              <th className="px-16 py-3 border-2 border-gray-200">
                Published Date
              </th>
              <th className="px-16 py-3 border-2 border-gray-200">
                Last Modified Date
              </th>
              <th className="px-16 py-3 border-2 border-gray-200">Status</th>
            </tr>
          </thead>
          <tbody>
            {cves.map((cve) => (
              
                <tr key={cve.id} className="hover:bg-gray-100 cursor-pointer"  onClick={() => navigate(`/cves/${cve.id}`)}>
                  
                  <td className="px-16 py-3 border-2 border-gray-200">{cve.id}</td>
                  <td className="px-16 py-3 border-2 border-gray-200">
                    {cve.sourceIdentifier}
                  </td>
                  <td className="px-16 py-3 border-2 border-gray-200">
                    {cve.publishedDate}
                  </td>
                  <td className="px-16 py-3 border-2 border-gray-200">
                    {cve.lastModifiedDate}
                  </td>
                  <td className="px-16 py-3 border-2 border-gray-200">
                    {cve.vulnStatus}
                  </td>
                
                </tr>
          
            ))}
          </tbody>
        </table>
      </div>
      <div>
        <div>
          <label htmlFor="resultsPerPage">Results Per Page:</label>
          <select
            id="resultsPerPage"
            onChange={handleResultsPerPageChange}
            value={resultsPerPage}
          >
            <option value="10">10</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
        </div>
        <div></div>
      </div>
    </div>
  );
};

export default CveList;
